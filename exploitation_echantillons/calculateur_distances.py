from exploitation_echantillons.espece_averee import EspeceAveree

#fonction moins robuste et trop simple que mutation_replacement_distance
#def distance_hamming(genome1, genome2) -> int:
#    """
#        Calcule la distance entre 2 chaines en utilisant l'algorithme de hamming
#
#        Param genome1: la séquence ADN n°1
#        Param genome2: la séquence ADN n°2
#
#        Return : la distance séparant les 2 chaines de caractères
#    """
#    distance = 0
#    for index_nucleotide in range(len(genome1)):
#        if genome1[index_nucleotide] != genome2[index_nucleotide]:
#            distance += 1
#    return distance


def mutation_replacement_distance(inital_sequence: str,
                                  compared_sequence: str) -> int:
    """
    Compare deux séquences ADN et retourne la distance entre les deux séquences.

    param sequence1: La première séquence ADN à comparer.
    param sequence2: La deuxieme séquence ADN à comparer.

    return: La distance des deux fichiers
    """

    distance = 0
    seq1_lenght = len(inital_sequence)
    seq2_lenght = len(compared_sequence)
    # on ajoute la différence de longueur à la distance
    distance += abs(seq1_lenght - seq2_lenght)
    # on boucle sur la séquence la plus petite
    for i in range(min(seq2_lenght, seq1_lenght)):
        if inital_sequence[i] != compared_sequence[i]:
            distance += 1
    return distance


def calculer_distance(espece1, espece2):
    """
        Calcule la distance entre deux espèces, qu'elles soient avérées ou hypothétiques.

        Param espece1 : Une espèce
        Param espece2 : Une autre espèce

        Return : la distance entre espece1 et espece2
    """
    #Dans le cas ou les 2 espèces sont les mêmes
    if espece1 is espece2:
        return 0
    #Dans le cas où les deux espèce sont des espèces avérées
    if isinstance(espece2, EspeceAveree) and isinstance(espece1, EspeceAveree):
        return mutation_replacement_distance(espece1.get_genome(),
                                             espece2.get_genome())

    #Dans le cas où espèce1 est hypothétique
    elif not isinstance(espece1, EspeceAveree):
        if not espece1.enfants:
            if not espece2.enfants:
                return 1.0
            return calculer_distance(espece1=espece2, espece2=espece1)

        somme_distances = 0
        for enfant in espece1.enfants:
            somme_distances += calculer_distance(enfant, espece2)
        return somme_distances / len(espece1.enfants)

    #Dans le cas où espèce2 est hypothétique (et espece1 est avérée)
    elif not isinstance(espece2, EspeceAveree):

        return calculer_distance(espece1=espece2, espece2=espece1)

    return 0
