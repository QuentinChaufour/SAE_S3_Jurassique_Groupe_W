from espece import EspeceHypothetique
from espece_averee import EspeceAveree
from calculateur_distances import calculer_distance
from echantillon import Echantillon

def reconstruire_arbre(liste_especes_de_depart: list) -> EspeceHypothetique:
    """
    Construit un arbre phylogénétique à partir d'une liste d'espèces
    (qui sont les feuilles de l'arbre).
    """
    
    noeuds_actifs = liste_especes_de_depart.copy()
    while len(noeuds_actifs) >= 2:
        paire_min = trouver_paire_minimale(noeuds_actifs)
        
        noeud1, noeud2 = paire_min
        noeuds_actifs.remove(noeud1)
        noeuds_actifs.remove(noeud2)
        # 2. On crée leur parent
        nom_parent = f"({noeud1.get_nom()} et {noeud2.get_nom()})"
        nom_sci_parent = f"({noeud1.get_nom_sci()}, {noeud2.get_nom_sci()})"
        
        nouvel_ancetre = EspeceHypothetique(nom_parent, nom_sci_parent)
        nouvel_ancetre.add_enfants(noeud1)
        nouvel_ancetre.add_enfants(noeud2)

        noeuds_actifs.append(nouvel_ancetre)

    #On retourne la racine de l'arbre    
    return noeuds_actifs[0]


def trouver_paire_minimale(noeuds: list) -> tuple:
    """
    Trouve la paire d'espèces avec la distance minimale entre elles.
    """
    distance_min = None
    # for imbriqué afin de vérifier la distance sur tout les noeuds
    for noeud1 in noeuds:
        for noeud2 in noeuds:
            # tant que les 2 noeuds sont différents chacun de l'autre
            if noeud1 != noeud2:
                distance_init = calculer_distance(noeud1, noeud2)
                if distance_min == None or distance_min > distance_init:
                    distance_min = distance_init   
                    paire_min = (noeud1,noeud2)
    return paire_min