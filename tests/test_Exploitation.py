import exploitation_echantillons.calculateur_distances as calc_dist
from exploitation_echantillons.espece_averee import EspeceAveree
from exploitation_echantillons.espece import EspeceHypothetique
from exploitation_echantillons.echantillon import Echantillon

placentalia = EspeceHypothetique("Placentaire","Placentalia")

atlantogenata = EspeceHypothetique("Atlantogenata", "Atlantogenata")
boreoeutheria = EspeceHypothetique("Boréoeuthériens", "Boreoeutheria")

placentalia.add_enfants(atlantogenata)
placentalia.add_enfants(boreoeutheria)

xenarthra = EspeceAveree("Xénarthres", "Xenarthra", "TCGTACG")
afrotheria = EspeceAveree("Afrothériens", "Afrotheria", "TTCCATG")

atlantogenata.add_enfants(xenarthra)
atlantogenata.add_enfants(afrotheria)

euarchontoglires = EspeceHypothetique("Euarchontoglires","Euarchontoglires")
laurasiatheria = EspeceHypothetique("Laurasiathériens","Laurasiatheria")

boreoeutheria.add_enfants(euarchontoglires)
boreoeutheria.add_enfants(laurasiatheria)

euarchonta = EspeceAveree("Euarchonta", "Euarchonta", "TACCTGA")
glires = EspeceAveree("Glires", "Glires", "ACGTACG")

euarchontoglires.add_enfants(euarchonta)
euarchontoglires.add_enfants(glires)

insectivora = EspeceAveree("Insectivores", "Insectivora", "TCGCACA")
scrotifera = EspeceHypothetique("Scrotifères","Scrotifera")

laurasiatheria.add_enfants(insectivora)
laurasiatheria.add_enfants(scrotifera)


def test_echantillon():
    assert (len(Echantillon.create_sequence(10)) == 10)

    sample: str = "ACGTACGTAGCT"

    assert (Echantillon.mutation_replacement(sample, 1) != sample)
    assert (Echantillon.mutation_insertion(sample, 1) != sample)
    assert (Echantillon.mutation_deletion(sample, 1) != sample)

    assert (Echantillon.mutation(sample, 0.3, 0.3, 0.1) != sample)

    assert (Echantillon.levenshtein("ACGT", "ACGT") == 0)
    assert (Echantillon.levenshtein("ACGT", "") == 4)
    assert (Echantillon.levenshtein("niche", "chiens") == 5)

    assert (Echantillon.sample_reader("tests/test.adn") == "ACTTGA")
    assert (Echantillon.sample_writer("tests/test_invalid.adn", "ACGT") is None)

    assert (Echantillon.mutation_replacement_distance("ATCTTGGA","ATCTCGGACTA") == 4)




def test_calclateur_distance():
    genome1 = "ACGTACGT"
    genome2 = "ACGTTCGT"
    assert calc_dist.distance_hamming(genome1, genome2) == 1

    assert (calc_dist.calculer_distance(laurasiatheria, scrotifera) == 0.5)
    assert (calc_dist.calculer_distance(insectivora, scrotifera) == 1)
    assert (calc_dist.calculer_distance(laurasiatheria, scrotifera) == 0.5)
    assert (calc_dist.calculer_distance(glires, glires) == 0)
    assert (calc_dist.calculer_distance(glires, insectivora) == 3)
    assert (calc_dist.calculer_distance(placentalia, atlantogenata) == 1.5)